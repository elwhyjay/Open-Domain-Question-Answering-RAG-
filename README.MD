# level 2. Open-Domain Question Answering (RAG)

<br>

# ğŸ” í”„ë¡œì íŠ¸ ì†Œê°œ

<p align='center'>
  <img src="img/odqa.png" width="800" style="vertical-align:middle;">  
</p>

| **ê°œìš”** | **ì„¤ëª…** |
| --- | --- |
| **ì£¼ì œ** |  ì£¼ì–´ì§„ ì§ˆë¬¸ì— ëŒ€í•´ ì •í•´ì§„ ì§€ë¬¸ì´ ì—†ì´ ì‚¬ì „ì— êµ¬ì¶•ë˜ì–´ ìˆëŠ” Knowledge resourceì—ì„œ <br> ì§ˆë¬¸ì— ëŒ€í•œ ë‹µë³€ì„ ì°¾ëŠ” ê³¼ì • |
| **ë°ì´í„°ì…‹** | **train_dataset** train: 3,952, validation: 240 <br> **test_dataset** validation: 240(public), 360(private) <br> **wikipedia_documents** 60,613 |
| **í‰ê°€** | â€¢ **ë‘ ê°€ì§€ í‰ê°€ì§€í‘œ**ë¥¼ ì‚¬ìš©(EM ê¸°ì¤€ìœ¼ë¡œ ë°˜ì˜ë˜ê³ , F1ì€ ì°¸ê³ ìš©ìœ¼ë¡œë§Œ í™œìš©) <br> â€¢ **Exact Match**(EM): ëª¨ë¸ì˜ ì˜ˆì¸¡ê³¼, ì‹¤ì œ ë‹µì´ ì •í™•í•˜ê²Œ ì¼ì¹˜í•  ë•Œë§Œ ì ìˆ˜ê°€ ì£¼ì–´ì§„ë‹¤. <br> â€¢ **F1 Score**: EMê³¼ ë‹¤ë¥´ê²Œ ê²¹ì¹˜ëŠ” ë‹¨ì–´ë„ ìˆëŠ” ê²ƒì„ ê³ ë ¤í•´ ë¶€ë¶„ ì ìˆ˜ë¥¼ ì œê³µí•œë‹¤. |
| **ê°œë°œ í™˜ê²½** | **`GPU`**: Tesla V100 Sever 4ëŒ€, **`IDE`**: Vscode, Jupyter Notebook |

<br>

# ğŸ‘¨ğŸ»â€ğŸ’»Â íŒ€ì› ì†Œê°œ ë° ì—­í• 

<div align='center'>
  
|ê¶Œìœ ì§„ [<img src="img/github-mark.png" width="20" style="vertical-align:middle;">](https://github.com/0618yujin)|ë°•ë¬´ì¬ [<img src="img/github-mark.png" width="20" style="vertical-align:middle;">](https://github.com/Mujae)|ë°•ì •ë¯¸ [<img src="img/github-mark.png" width="20" style="vertical-align:middle;">](https://github.com/imJeongmi)|ì´ìš©ì¤€ [<img src="img/github-mark.png" width="20" style="vertical-align:middle;">](https://github.com/elwhyjay)|ì •ì›ì‹ [<img src="img/github-mark.png" width="20" style="vertical-align:middle;">](https://github.com/wonsjeong)|
|:-:|:-:|:-:|:-:|:-:|
|<img src='img/profile-1.jpeg' height="125" width="125"></img>|<img src='img/profile-2.jpeg' height="125" width="125"></img>|<img src='img/profile-3.jpeg' height="125" width="125"></img>|<img src='img/profile-4.jpeg' height="125" width="125"></img>|<img src='img/profile-5.jpeg' height="125" width="125"></img>|
|Retriever ëª¨ë¸(BM25, TF-IDF+BM25) êµ¬í˜„|Retriever ëª¨ë¸(DPR) êµ¬í˜„ ë° ëª¨ë“ˆí™”, negative sampling êµ¬í˜„, ì•™ìƒë¸”|EDA, ë°ì´í„° ì „ì²˜ë¦¬, KorQuAD ë°ì´í„° ì¦ê°•|PM, base-code ëª¨ë“ˆí™” ë° í™˜ê²½ì„¸íŒ…, Colbert êµ¬í˜„, elastic-search êµ¬í˜„, ì‹¤í—˜ ë° ì•™ìƒë¸”|Reader ëª¨ë¸ ë¦¬ì„œì¹˜, ëª¨ë¸ ì‹¤í—˜, Hyperparameter tuning|

</div> <br>

# ğŸ“ŠÂ íƒìƒ‰ì  ë¶„ì„ ë° ì „ì²˜ë¦¬

### íƒìƒ‰ì  ë¶„ì„

- ë°ì´í„° ë¶„í¬ ë° íŠ¹ì„± ë¶„ì„

### ì „ì²˜ë¦¬

- ê¸°íƒ€ íŠ¹ìˆ˜ë¬¸ì ë° ê°œí–‰ë¬¸ì ì œê±°
- ì¤‘ë³µëœ context ì œê±°

### ë°ì´í„° ì¦ê°•

- KorQuAD 1.0
    - train: 64,359ê°œ / validation: 6,014ê°œ
- KorQuAD 2.1
    - train: 124,240ê°œ / validation: 17,551ê°œ

### ë°ì´í„° ë²„ì „

| **Data Version** | **ë²„ì „ ì„¤ëª…** |
| --- | --- |
| **v1** | ê¸°íƒ€ íŠ¹ìˆ˜ë¬¸ìë¥¼ ê³µë°±ìœ¼ë¡œ ë³€í™˜ |
| **v2** | ê¸°íƒ€ íŠ¹ìˆ˜ë¬¸ì ë° ê°œí–‰ë¬¸ì, wikipediaì˜ ì¤‘ë³µëœ context ì œê±° |
| **v3** | KorQuAD 1.0 ì¶”ê°€(+ v2ì™€ ë™ì¼í•œ ì „ì²˜ë¦¬) |
| **v4** | KorQuAD 1.0ê³¼ KorQuAD 2.1ë¡œë§Œ êµ¬ì„±(+ v2ì™€ ë™ì¼í•œ ì „ì²˜ë¦¬) |

<br>

# âš’ï¸Â ê°œë°œ

### í”„ë¡œì íŠ¸ êµ¬ì¡°

<p align='center'>
  <img src='img/image-1.png' width='300'>
</p

### ëª¨ë¸ ë¶„ì„ ë° ì„±ëŠ¥ ê°œì„ 

| **ë¶„ë¥˜** |  | **ë‚´ìš©** |
| --- | --- | --- |
| **Retrieval** | **Sparse** | í…ìŠ¤íŠ¸ì˜ ë‹¨ì–´ ë¹ˆë„ë¥¼ ê¸°ë°˜ìœ¼ë¡œ ë¬¸ì„œì™€ ì¿¼ë¦¬ ê°„ì˜ ìœ ì‚¬ë„ë¥¼ ê³„ì‚°í•œë‹¤. ì£¼ë¡œ TF-IDFì™€ BM25ì™€ ê°™ì€ ì•Œê³ ë¦¬ì¦˜ì´ ì‚¬ìš©ë˜ë©°, ë†’ì€ ì •ë°€ë„ë¥¼ ê°€ì§€ì§€ë§Œ, ë¬¸ì¥ ê°„ ì˜ë¯¸ì  ìœ ì‚¬ë„ë¥¼ ì˜ ë°˜ì˜í•˜ì§€ ëª»í•˜ëŠ” í•œê³„ê°€ ìˆë‹¤. <br><br> ì‚¬ìš©í•œ ëª¨ë¸: TF-IDF, BM25, TF-IDF + BM25, Elastic Search |
|  | **Dense** | ë”¥ëŸ¬ë‹ ê¸°ë°˜ ì„ë² ë”© ëª¨ë¸(Bert)ì„ í™œìš©í•˜ì—¬ ë¬¸ì„œì™€ ì¿¼ë¦¬ë¥¼ ë°€ì§‘ ë²¡í„° ê³µê°„ì— ë§¤í•‘í•œ í›„, ì´ ë²¡í„°ë“¤ ê°„ì˜ ìœ ì‚¬ë„ë¥¼ ê³„ì‚°í•˜ì—¬ ê°€ì¥ ê´€ë ¨ì„± ë†’ì€ ë¬¸ì„œë¥¼ ì°¾ëŠ”ë‹¤. <br><br> ì‚¬ìš©í•œ ëª¨ë¸: klue/bert-base, klue/roberta(base, large) <br><br> ëª¨ë¸ êµ¬ì¡°: Cross-Attention Encoder, Dual-Encoder, Colbert |
| **Reader** |  | ì‚¬ìš©í•œ ëª¨ë¸: klue/bert-base, monologg/koelectra-base-v3-discriminator, klue/roberta-large, DHBaek/xlm-roberta-large-korquad-mask, hanmaroo/xlm_roberta_large_korquad_v1, team-lucid/deberta-v3-xlarge-korean |

### ê°œì„  ì•„ì´ë””ì–´

| **ë¶„ë¥˜** |  | **ë‚´ìš©** |
| --- | --- | --- |
| **Retrieval** | **Sparse** | **TF-IDF + BM25**: TF-IDFë¡œ ì „ì²´ì ì¸ ë‹¨ì–´ ë¹ˆë„ ê¸°ë°˜ì˜ ìœ ì‚¬ë„ë¥¼ êµ¬í•˜ê³ , BM25ì˜ ê°€ì¤‘ì¹˜ë¥¼ ì¶”ê°€í•˜ì—¬ ë¬¸ì„œì˜ ê¸¸ì´ì™€ ë¹ˆë„ë¥¼ ë³´ì • <br> **Re-Ranking**: Sparse ë¥¼ ì´ìš©í•´ í›„ë³´ Passageë¥¼ ì •í•˜ê³  Dense Retrievalë¡œ ë‹¤ì‹œ rankingí•˜ëŠ” ë°©ë²•ì„ ì ìš© |
|  | **Dense** | **Hard negative sampling**: BM25ë¥¼ í†µí•´ ì§ˆë¬¸ê³¼ ì§€ë¬¸ë“¤ì„ scoringí•˜ì—¬ top-nê°œì˜ ì§€ë¬¸ì„ negativeë¡œ í™œìš© <br> **Gradient accumulation**: ì—¬ëŸ¬ ë¯¸ë‹ˆ ë°°ì¹˜ì˜ ê·¸ë¼ë””ì–¸íŠ¸ë¥¼ ëˆ„ì í•´ ë§ˆì¹˜ í° Batch sizeë¡œ í•™ìŠµí•˜ëŠ” íš¨ê³¼ <br> **Gradient cache**: in-batch íš¨ê³¼ë¥¼ ì‚´ë¦´ ìˆ˜ ìˆëŠ” ë°©ë²• <br> **Mixed precision**: ëª¨ë¸ íŒŒë¼ë¯¸í„°ì˜ ì¼ë¶€ë¥¼ 16-bitë¡œ ì²˜ë¦¬í•˜ì—¬ ë©”ëª¨ë¦¬ ì‚¬ìš©ëŸ‰ì„ ì¤„ì´ê³ , í•™ìŠµ ì†ë„ë¥¼ ë†’ì´ëŠ” ë°©ì‹ <br> **Colbert**: late interactionì´ë€ ì•„ì´ë””ì–´ë¥¼ ì´ìš©í•´ bi-encoderì™€ cross-encoder ë‘ ê°€ì§€ ì„¤ê³„ì˜ ì¥ì ì„ ì·¨í•  ìˆ˜ ìˆìŒ |
| **Reader** |  | **Curriculum Learning**: ë°ì´í„°ì…‹ì˜ ìˆœì„œë¥¼ ì¡°ì •í•˜ì—¬ ëª¨ë¸ì´ í•™ìŠµí•˜ê¸° ì–´ë ¤ìš´ê²ƒì„ ë’¤ë¡œ ë°°ì¹˜í•˜ì—¬ ëª¨ë¸ì´ ì ì°¨ì ìœ¼ë¡œ í•™ìŠµí•˜ì—¬ ì„±ëŠ¥ì„ ê°œì„ ì‹œí‚¤ê¸° ìœ„í•œ ë°©ë²•ë¡  |

# ğŸ’¥Â ì‹¤í—˜ ë° ê²°ê³¼

### ëª¨ë¸ ì„±ëŠ¥ ë° ì„ ì •

- **Retrieval** ì„±ëŠ¥
    
    
    |  | **TF-IDF** | **BM25** | **TF-IDF + BM25** | **klue/bert-base(1epoch)** |
    | --- | --- | --- | --- | --- |
    | Top_1 | 26.45 | 54.68 | 37.66 | 24.52 |
    | **Top_10** | **65.56** | **88.71** | **79.76** | 51.69 |
    | Top_20 | 73.55 | 91.94 | 86.45 | 59.03 |
    | Top_30 | 78.23 | 93.55 | 89.27 | 63.23 |
    | Top_40 | 81.05 | 94.44 | 90.73 | 66.21 |
    | Top_50 | 83.63 | 95.16 | 91.53 | 67.98 |
    | Top_100 | 88.55 | 96.05 | 94.35 | 75.48 |
- **Reader** ì„±ëŠ¥
    - ëª¨ë¸ë³„ EM, F1 Score ë¹„êµ
        
        
        | Reader | EM | F1 | Epoch | Batch size |
        | --- | --- | --- | --- | --- |
        | klue/bert-base | 59.833 | 69.641 | 15 | 24 |
        | monologg/koelectra-base-v3-discriminator | 56.250 | 65.864 | 15 | 24 |
        | **klue/roberta-large** | **69.583** | **77.280** | 1 | 24 |
        | team-lucid/deberta-v3-xlarge-korean | 56.250 | 66.563 | 1 | 8 |
        | hanmaroo/xlm_roberta_large_korquad_v1 | 57.083 | 67.490 | 1 | 20 |
        | DHBaek/xlm-roberta-large-korquad-mask | 58.333 | 68.427 | 1 | 20 |
    - max_seq_length, doc_strideì— ë”°ë¥¸ ë¹„êµ
        
        
        | Model name | EM | F1 | max_seq_length | doc_stride | doc_stride/max_seq_length |
        | --- | --- | --- | --- | --- | --- |
        | **klue/bert-base** | **59.833** | **69.641** | **384** | **128** | **0.333333333** |
        | klue/bert-base | 57.083 | 65.419 | 512 | 128 | 0.25 |
        | klue/bert-base | 59.583 | 68.521 | 512 | 256 | 0.5 |
    - n_best_sizeì— ë”°ë¥¸ ë¹„êµ
        
        
        | Model name | EM | F1 | n_best_size | EM ê°œì„ ìœ¨(%) |
        | --- | --- | --- | --- | --- |
        | klue/bert-base | 59.833 | 69.641 | 20 | - |
        | **klue/bert-base** | **60.12** | **67.537** | **40** | **0.48** |
    - no_answer í† í° ì¶”ê°€ì— ë”°ë¥¸ ë¹„êµ
        
        
        | Model name | EM | F1 | no_answer í† í° ì¶”ê°€ | null_score_diff_threshold | EM ê°œì„ ìœ¨(%) |
        | --- | --- | --- | --- | --- | --- |
        | **klue/bert-base** | **59.833** | **69.641** | **X** | - | - |
        | klue/bert-base | 58.333 | 65.766 | O | 0 | -2.506 |
        | klue/bert-base | 58.333 | 65.766 | O | 1 | -2.506 |
        | klue/bert-base | 58.333 | 65.766 | O | 5 | -2.506 |
    - LoRA ì‚¬ìš©ì— ë”°ë¥¸ ë¹„êµ
        
        
        | Model name | EM | F1 | LoRA | EM ê°œì„ ìœ¨(%) |
        | --- | --- | --- | --- | --- |
        | **klue/bert-base** | **59.833** | **69.641** | **X** | **-** |
        | klue/bert-base | 56.25 | 66.213 | O | -5.988 |
    - ë°ì´í„° ì „ì²˜ë¦¬ì— ë”°ë¥¸ ë¹„êµ
        
        
        | Model name | EM | F1 | ë°ì´í„° ì „ì²˜ë¦¬ | EM ê°œì„ ìœ¨(%) |
        | --- | --- | --- | --- | --- |
        | klue/bert-base | 59.833 | 69.641 | X | - |
        | **klue/bert-base** | **61.25** | **68.583** | **O** | **2.368** |

- ì•™ìƒë¸” ëª¨ë¸
    - ReaderëŠ” roberta-large ì‚¬ìš©
        
        
        | Retrieval version | EM | F1 |
        | --- | --- | --- |
        | BM25+  | 60.4200 | 71.5300 |
        | BM25 + pretaining  | 57.9200 | 68.3600 |
        | Elastic Search | 59.1700 | 69.9300 |
        | Colbert | 54.1700 | 64.6800 |
        | BM25Okapi | 55.4200 | 65.0200 |

### ê²°ê³¼

- ë¦¬ë”ë³´ë“œ [ì¤‘ê°„ ìˆœìœ„]

<p align='center'>
  <img src='img/result-1.png' width='800'>
</p>
    
- ë¦¬ë”ë³´ë“œ [ìµœì¢… ìˆœìœ„]

<p align='center'>
  <img src='img/result-2.png' width='800'>
</p>
